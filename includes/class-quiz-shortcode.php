<?phpdefined( 'ABSPATH' ) || exit;class Quiz_Shortcode {	/**	 * class constructor	 */	public function __construct() {		add_shortcode( 'qp-quiz', array( $this, 'quiz_shortcode' ) );        add_action('wp_ajax_qp_quiz_submission', array($this, 'qp_quiz_submission'));        add_action('wp_ajax_nopriv_qp_quiz_submission', array($this, 'qp_quiz_submission'));	}		/**	 * Quiz shortcode for frontend	 *	 * @param array $attrs Attributes	 *	 * @return mixed	 * @since 1.0.0	 */	public function quiz_shortcode( $attrs ) {		$attrs = shortcode_atts(			array( 'quiz_id' => '' ), $attrs		);				ob_start();		if ( empty( $attrs['quiz_id'] ) ) {			return 'No specific quiz is selected';		}				$quiz_id = $attrs['quiz_id'];		?>        <form action="" method="post" name="quiz-submission-form" class="quiz-submission-form">            <label for=""><?php echo 'Quizzes'; ?></label>			<?php			$quiz_questions = get_post_meta( $quiz_id, 'qp-quiz-questions', true );			//var_dump( $quiz_questions );			foreach ( $quiz_questions as $single ) {				$question = get_post( $single );				//var_dump( $question );				?>                <p id="<?php echo $question->ID ?>"><?php echo 'Question: ' . $question->post_title ?></p>								<?php $first_answer = get_post_meta( $question->ID, 'qp-question-answers-1', true ); ?>				<?php if ( ! empty( $first_answer ) ): ?>                    <input type="radio" id="qp-question-answers-1" name="qp-question-answers-<?php echo $question->ID ?>" value="qp-question-answers-1" required>                    <label for="qp-question-answers-1"><?php echo $first_answer; ?></label>				<?php endif; ?>								<?php $second_answer = get_post_meta( $question->ID, 'qp-question-answers-2', true ); ?>				<?php if ( ! empty( $second_answer ) ): ?>                    <input type="radio" id="qp-question-answers-2" name="qp-question-answers-<?php echo $question->ID ?>" value="qp-question-answers-2" required>                    <label for="qp-question-answers-2"><?php echo $second_answer; ?></label>				<?php endif; ?>								<?php $third_answer = get_post_meta( $question->ID, 'qp-question-answers-3', true ); ?>				<?php if ( ! empty( $third_answer ) ): ?>                    <input type="radio" id="qp-question-answers-3" name="qp-question-answers-<?php echo $question->ID ?>" value="qp-question-answers-3" required>                    <label for="qp-question-answers-3"><?php echo $third_answer; ?></label>				<?php endif; ?>								<?php $forth_answer = get_post_meta( $question->ID, 'qp-question-answers-4', true ); ?>				<?php if ( ! empty( $third_answer ) ): ?>                    <input type="radio" id="qp-question-answers-4" name="qp-question-answers-<?php echo $question->ID ?>" value="qp-question-answers-4" required>                    <label for="qp-question-answers-4"><?php echo $forth_answer; ?></label>				<?php endif; ?>				<?php							}			?>            <br>	        <?php wp_nonce_field( 'qp-quiz-nonce' ); ?>            <input type="hidden" name="quiz_id" value="<?php echo $quiz_id; ?>">            <input type="submit" class="wp-block-button__link" value="submit" name="Submit Answers">			        </form>                <div class="result">                </div>				<?php				return ob_get_clean();	}        /**     * Quiz submission handler     *     * @since 1.0.0    */    public function qp_quiz_submission() {        $data = wp_parse_args( $_REQUEST['data'] );	    	    $quiz_id = $data['quiz_id'];        $quiz_questions = get_post_meta( $quiz_id, 'qp-quiz-questions', true );        $submissions = array();        $correct_submission = 0;        $wrong_submission = 0;        $total_questions = count($quiz_questions);        if ( is_array( $quiz_questions ) && count( $quiz_questions ) ) {	        foreach ( $quiz_questions as $question ) {                $given = $data['qp-question-answers-'.$question];                $correct_answer = get_post_meta( $question, 'qp-question-correct-answer', true );                if( $correct_answer == $given ) {                    $submissions[] = [                            'question-id' => $question,                            'correct' => 'yes',                    ];                } else {	                $submissions[] = [		                'question-id' => $question,		                'correct' => 'no',	                ];                }	        }                 }        	    $total_submissions = count( $submissions );        if( is_array( $submissions ) && count( $submissions ) ) {            foreach ( $submissions as $single ) {	            $correct_submission += ( 'yes' == $single['correct'] ) ? 1 : 0;	            $wrong_submission += ( 'no' == $single['correct'] ) ? 1 : 0;            }        }                ?>        <p>Total Submissions: <?php echo $total_submissions;?></p>        <p>Correct Submissions: <?php echo $correct_submission;?></p>        <p>Wrong Submissions: <?php echo $wrong_submission;?></p>        <p>Number: <?php echo $correct_submission . ' out of '. $total_questions;?></p>                <?php                        die();    }}new Quiz_Shortcode();